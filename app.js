const statusDot=document.getElementById('status-dot');const statusText=document.getElementById('status-text');const wa=document.getElementById('wa');const csvInput=document.getElementById('csv-input');const numbersTable=document.getElementById('numbers-table');const msg=document.getElementById('message');const attach=document.getElementById('file-attach');const attachList=document.getElementById('attach-list');
wa.addEventListener('did-finish-load', async()=>{statusDot.style.background='#ffd166';statusText.textContent='טוען...';const url=await wa.getURL();if(url.includes('web.whatsapp.com')){statusDot.style.background='#06d6a0';statusText.textContent='מחובר (דרך WhatsApp Web)';}});
document.getElementById('btn-open-wa').onclick=()=>{wa.reload();};
csvInput.addEventListener('change', async e=>{const file=e.target.files[0];if(!file)return;const text=await file.text();const lines=text.split(/\r?\n/).filter(Boolean);while(numbersTable.children.length>1)numbersTable.removeChild(numbersTable.lastChild);for(const line of lines){const [name='',number='',var1='']=line.split(',').map(s=>s.trim());const row=document.createElement('div');row.className='row';row.innerHTML=`<div>${name}</div><div>${number}</div><div>${var1}</div>`;numbersTable.appendChild(row);}});
attach.addEventListener('change',()=>{attachList.innerHTML='';for(const f of attach.files){const chip=document.createElement('span');chip.className='chip';chip.textContent=f.name;attachList.appendChild(chip);}});
document.getElementById('btn-send').onclick=async()=>{alert('MVP: הדגמה בלבד - בשלב הבא נוסיף שליחה אמיתית');console.log('Would send:',msg.value);};
document.getElementById('btn-insert-var').onclick=()=>{const p=msg.selectionStart||msg.value.length;const before=msg.value.slice(0,p);const after=msg.value.slice(p);msg.value=before+'{שם}'+after;msg.focus();msg.selectionStart=msg.selectionEnd=p+4;};
